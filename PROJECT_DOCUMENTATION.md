# 📚 مستندات پروژه وب‌سایت تعاملی

## 🎯 **معرفی پروژه**
وب‌سایت تعاملی با قابلیت‌های کاربری، ادمین و سیستم بازی زوج‌شناسی

## 🏗️ **معماری سیستم**

### **Frontend (React.js)**
- **React 18** با Hooks
- **React Router DOM** برای مسیریابی
- **Tailwind CSS** برای استایل‌دهی
- **React Hook Form** برای فرم‌ها
- **React Hot Toast** برای اعلان‌ها
- **Lucide React** برای آیکون‌ها
- **Axios** برای درخواست‌های HTTP

### **Backend (Node.js)**
- **Express.js** برای سرور
- **MongoDB** با Mongoose برای دیتابیس
- **JWT** برای احراز هویت
- **bcryptjs** برای رمزنگاری
- **express-validator** برای اعتبارسنجی
- **Multer** برای آپلود فایل

## 🔐 **سیستم احراز هویت**

### **مدل کاربر (User)**
```javascript
{
  firstName: String,           // نام
  lastName: String,            // نام خانوادگی
  nationalCode: String,        // کد ملی
  phoneNumber: String,         // شماره تلفن
  email: String,               // ایمیل
  password: String,            // رمز عبور (هش شده)
  birthDate: Date,             // تاریخ تولد
  gender: String,              // جنسیت
  address: String,             // آدرس
  spouseFirstName: String,     // نام همسر
  spouseLastName: String,      // نام خانوادگی همسر
  spouseNationalCode: String,  // کد ملی همسر
  spousePhoneNumber: String,   // شماره تلفن همسر
  isAdmin: Boolean,            // آیا ادمین است
  isActive: Boolean,           // آیا فعال است
  createdAt: Date,             // تاریخ ایجاد
  updatedAt: Date              // تاریخ به‌روزرسانی
}
```

### **API های احراز هویت**
- `POST /api/auth/register` - ثبت‌نام کاربر
- `POST /api/auth/login` - ورود کاربر
- `POST /api/auth/forgot-password` - فراموشی رمز عبور

## 🎮 **سیستم بازی زوج‌شناسی**

### **هدف**
سنجش میزان شناخت زوج‌ها از یکدیگر با پاسخ به سوالات مشابه

### **منطق بازی**
1. **شروع بازی**: کاربر وارد بازی می‌شود
2. **انتظار همسر**: تا ورود همسر منتظر می‌ماند
3. **شروع سوالات**: با ورود همسر، بازی شروع می‌شود
4. **پاسخ‌دهی**: هر دو نفر به سوالات پاسخ می‌دهند
5. **محاسبه امتیاز**: بر اساس تشابه پاسخ‌ها
6. **نمایش نتیجه**: درصد تشابه و امتیاز نهایی

### **قوانین بازی**
- هر دو نفر باید به همه سوالات پاسخ دهند
- امتیاز بر اساس تشابه پاسخ‌ها محاسبه می‌شود
- زمان محدود برای هر بازی
- سوالات به صورت تصادفی برای هر همسر نمایش داده می‌شود

## 📊 **مدل‌های دیتابیس**

### **CoupleGame (بازی)**
```javascript
{
  title: String,               // عنوان بازی
  description: String,         // توضیحات
  questions: [{                // سوالات
    question: String,          // متن سوال
    options: [String],         // گزینه‌ها
    correctAnswer: Number,     // پاسخ صحیح
    points: Number             // امتیاز
  }],
  timeLimit: Number,           // زمان محدود (دقیقه)
  startDate: Date,             // تاریخ شروع
  endDate: Date,               // تاریخ پایان
  isActive: Boolean,           // آیا فعال است
  createdBy: ObjectId,         // ایجاد کننده
  createdAt: Date,             // تاریخ ایجاد
  updatedAt: Date              // تاریخ به‌روزرسانی
}
```

### **CoupleGameSession (جلسه بازی)**
```javascript
{
  gameId: ObjectId,            // شناسه بازی
  couple: {                    // زوج
    partner1: ObjectId,        // همسر اول
    partner2: ObjectId         // همسر دوم
  },
  status: String,              // وضعیت: waiting, active, completed
  startTime: Date,             // زمان شروع
  endTime: Date,               // زمان پایان
  timeRemaining: Number,       // زمان باقی‌مانده (ثانیه)
  questionsOrder: {            // ترتیب سوالات
    partner1: [Number],        // برای همسر اول
    partner2: [Number]         // برای همسر دوم
  },
  answers: {                   // پاسخ‌ها
    partner1: [{               // پاسخ‌های همسر اول
      questionIndex: Number,   // شماره سوال
      selectedOption: Number,  // گزینه انتخاب شده
      timeSpent: Number,       // زمان صرف شده
      answeredAt: Date         // زمان پاسخ
    }],
    partner2: [/* مشابه */]   // پاسخ‌های همسر دوم
  },
  score: {                     // امتیاز
    totalPoints: Number,       // امتیاز کل
    similarityPercentage: Number, // درصد تشابه
    matchingAnswers: Number,   // تعداد پاسخ‌های مشابه
    totalQuestions: Number     // تعداد کل سوالات
  },
  createdAt: Date,             // تاریخ ایجاد
  updatedAt: Date              // تاریخ به‌روزرسانی
}
```

## 🚀 **API های بازی زوج‌شناسی**

### **ادمین**
- `POST /api/couple-games/create` - ایجاد بازی جدید
- `GET /api/couple-games/admin/all` - دریافت همه بازی‌ها
- `PUT /api/couple-games/admin/:id` - ویرایش بازی
- `DELETE /api/couple-games/admin/:id` - حذف بازی

### **کاربر**
- `GET /api/couple-games/active` - دریافت بازی‌های فعال
- `POST /api/couple-games/start/:gameId` - شروع بازی
- `GET /api/couple-games/session/:sessionId` - دریافت وضعیت جلسه
- `POST /api/couple-games/answer/:sessionId` - ثبت پاسخ
- `GET /api/couple-games/results` - دریافت نتایج
- `GET /api/couple-games/leaderboard` - رتبه‌بندی

## 🎯 **سیستم امتیازدهی**

### **محاسبه امتیاز**
```javascript
calculateScore() {
  const partner1Answers = this.answers.partner1 || [];
  const partner2Answers = this.answers.partner2 || [];
  
  let matchingAnswers = 0;
  let totalQuestions = Math.max(partner1Answers.length, partner2Answers.length);
  
  // مقایسه پاسخ‌ها
  for (let i = 0; i < totalQuestions; i++) {
    const p1Answer = partner1Answers.find(a => a.questionIndex === i);
    const p2Answer = partner2Answers.find(a => a.questionIndex === i);
    
    if (p1Answer && p2Answer && p1Answer.selectedOption === p2Answer.selectedOption) {
      matchingAnswers++;
    }
  }
  
  // محاسبه درصد تشابه
  const similarityPercentage = totalQuestions > 0 ? 
    Math.round((matchingAnswers / totalQuestions) * 100) : 0;
  
  this.score = {
    totalPoints: matchingAnswers,
    similarityPercentage,
    matchingAnswers,
    totalQuestions
  };
}
```

## 🔧 **سیستم‌های دیگر**

### **Speech-to-Text**
- استفاده از Web Speech API برای تبدیل صوت به متن
- پشتیبانی از زبان فارسی
- قابلیت ضبط صدا و تبدیل real-time

### **مدیریت پروفایل**
- ویرایش اطلاعات شخصی
- تکمیل اطلاعات همسر
- آپلود تصویر پروفایل

### **سیستم آزمون و نظرسنجی**
- ایجاد آزمون‌های چندگزینه‌ای
- ایجاد نظرسنجی‌ها
- مدیریت نتایج و آمار

## 📱 **رابط کاربری**

### **صفحات اصلی**
- **صفحه اصلی**: معرفی و ورود
- **داشبورد کاربر**: دسترسی به امکانات
- **پروفایل**: مدیریت اطلاعات شخصی
- **بازی‌های زوج‌شناسی**: لیست و شرکت در بازی‌ها
- **آزمون‌ها**: شرکت در آزمون‌ها
- **نظرسنجی‌ها**: شرکت در نظرسنجی‌ها

### **پنل ادمین**
- مدیریت کاربران
- ایجاد و مدیریت بازی‌ها
- ایجاد آزمون و نظرسنجی
- مشاهده آمار و نتایج
- مدیریت Speech-to-Text

## ✅ **مشکلات حل شده**

### **مشکلات اصلی حل شده**
1. **منطق بازی**: منطق بازی زوج‌شناسی کاملاً بازنویسی شد
2. **مدیریت جلسات**: سیستم مدیریت وضعیت جلسات بهبود یافت
3. **ثبت پاسخ**: امکان ثبت پاسخ‌های تکراری برطرف شد
4. **محاسبه امتیاز**: سیستم امتیازدهی کاملاً بازنویسی شد
5. **نمایش نتایج**: سیستم نمایش نتایج و امتیازات بهبود یافت
6. **مدیریت زمان**: مدیریت زمان و وضعیت بازی کاملاً بازنویسی شد
7. **مشکل NaN در زمان**: خطای `NaN` در `updateTimeRemaining` حل شد
8. **پنل ادمین**: مشکلات حذف بازی، نمایش تعداد سوالات و دکمه‌ها حل شد
9. **نمایش بازی‌ها**: بازی‌ها در لابی کاربر و پنل ادمین درست نمایش داده می‌شوند
10. **تست کامل**: تمام مراحل بازی از شروع تا پایان تست شد
11. **همگام‌سازی وضعیت**: مشکل عدم همگام‌سازی وضعیت `waiting` بین دو همسر حل شد
12. **بارگذاری سوالات**: مشکل عدم بارگذاری سوالات پس از فعال شدن بازی حل شد
13. **نمایش نتایج در لابی**: نتایج بازی‌های زوج‌شناسی در داشبورد کاربر نمایش داده می‌شوند
14. **حذف نتایج بازی**: ادمین می‌تواند تمام نتایج یک بازی را حذف کند
15. **نمایش تاریخ و زمان**: مشکل نمایش تاریخ و زمان نامعتبر حل شد
16. **پنل ادمین نتایج**: بخش مشاهده تمام نتایج بازی‌های زوج‌شناسی اضافه شد
17. **مرتب‌سازی نتایج**: امکان مرتب‌سازی بر اساس ویژگی‌های مختلف
18. **خروجی Excel**: امکان دانلود نتایج در فرمت Excel

### **بهبودهای اعمال شده**
- کل منطق بازی زوج‌شناسی بازنویسی شد
- سیستم مدیریت جلسات با وضعیت‌های جدید
- محاسبه و نمایش امتیازات با دقت بالا
- مدیریت زمان هوشمند با قابلیت توقف/ادامه
- رابط کاربری بازی بهبود یافت
- سیستم لاگ و عیب‌یابی کامل
- پنل ادمین کاملاً کارکرد
- API های RESTful برای تمام عملیات
- سیستم احراز هویت و مجوزها
- مدیریت خطاها و validation
- سیستم polling برای همگام‌سازی وضعیت جلسات
- بهبود تولید ترتیب تصادفی سوالات
- API جدید برای دریافت وضعیت به‌روز شده جلسه

### **تست‌های انجام شده**
- ✅ تست ایجاد بازی در پنل ادمین
- ✅ تست حذف بازی در پنل ادمین
- ✅ تست نمایش بازی‌ها در لابی کاربر
- ✅ تست شروع بازی توسط زوج‌ها
- ✅ تست ثبت پاسخ‌ها
- ✅ تست محاسبه امتیاز تشابه
- ✅ تست مدیریت زمان بازی
- ✅ تست بازگشت به بازی بعد از خروج
- ✅ تست تکمیل بازی و نمایش نتایج
- ✅ تست همگام‌سازی وضعیت بین دو همسر
- ✅ تست بارگذاری سوالات پس از فعال شدن بازی

## 📋 **مراحل بعدی**
1. ✅ بازنویسی کامل منطق بازی زوج‌شناسی
2. ✅ اصلاح سیستم مدیریت جلسات
3. ✅ بهبود سیستم امتیازدهی
4. ✅ اصلاح رابط کاربری
5. ✅ تست کامل سیستم
6. ✅ مستندسازی نهایی
7. ✅ حل مشکل همگام‌سازی وضعیت بین همسران
8. ✅ حل مشکل بارگذاری سوالات

## 🚀 **آماده برای استفاده**
سیستم بازی زوج‌شناسی کاملاً آماده و تست شده است. تمام قابلیت‌های اصلی پیاده‌سازی شده و مشکلات حل شده‌اند.

---
**تاریخ به‌روزرسانی**: 23 آگوست 2025
**وضعیت**: ✅ **کامل و آماده** - تمام مشکلات حل شد
**تیم توسعه**: ✅ **پایان پروژه** - سیستم کاملاً کارکرد است
